package com.pixelpulse.pregunta03ec03.controller;

import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestHeader;
import org.springframework.web.bind.annotation.RequestParam;

public class CalculoController {
	private static final double y = 1.999999;

    @GetMapping("calcularR")
    public double calcularR(@RequestParam("x") double x, @RequestParam("a") double a,
                            @RequestHeader("Authorization") String token) {

        // Validar si el usuario está autenticado
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        if (authentication == null || !authentication.isAuthenticated()) {
            throw new RuntimeException("Acceso no autorizado. Token inválido.");
        }

        // Calcular m
        double m = (x + y) / 3;

        // Calcular R usando la fórmula dada
        double R = (3 * Math.pow(y, 3)) + ((Math.pow(a, 2) / Math.sqrt(m)) * ((2 * x) / (2 * y)));

        return R;
    }
}
